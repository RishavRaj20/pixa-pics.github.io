(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{487:function(t,i){var e=function(){function t(t,i){return(0|(t=(0|t)>>>0))>>>0==(0|(i=(0|i)>>>0))>>>0}function i(t,i){return((t=(0|t)>>>0)+(i=(0|i)>>>0)|0)>>>0}function e(t,i){return((t=(0|t)>>>0)&(i=(0|i)>>>0)|0)>>>0}function n(t,i){return((t=(0|t)>>>0)|(i=(0|i)>>>0)|0)>>>0}function s(t,i){return((t=(0|t)>>>0)^(i=(0|i)>>>0)|0)>>>0}function _(t){return(0|t)>>>5}function r(t){return(0|t)>>>0}function o(h){return this instanceof o?(this.format_uint_=r,this.plus_uint_=i,this.uint_equal_=t,this.uint_bit_and_=e,this.uint_bit_or_=n,this.uint_bit_xor_=s,this.uint_bitwise_5_=_,h instanceof o?this.data_=h.dataCopy:h instanceof Uint32Array?this.data_=h:(h=(0|h)>>>0,this.data_=new Uint32Array(1+((h+31|0)>>>5)),this.data_[this.data_.length-1]=(0|h)>>>0),this.M_OR_=u,this.M_AND_=a,this.M_OPP_=l,this.buildTemporaryIndexesDataStore(),this.I_=new Uint32Array(11),this):new o(h)}var h,u=Uint32Array.of(1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648),a=Uint32Array.of(4294967294,4294967293,4294967291,4294967287,4294967279,4294967263,4294967231,4294967167,4294967039,4294966783,4294966271,4294965247,4294963199,4294959103,4294950911,4294934527,4294901759,4294836223,4294705151,4294443007,4293918719,4292870143,4290772991,4286578687,4278190079,4261412863,4227858431,4160749567,4026531839,3758096383,3221225471,2147483647),l=Uint32Array.of(0,4294967295);return Object.defineProperties(o.prototype,{idealConstructor:{get:function(){return this.length>65535?Uint32Array:this.length>255?Uint16Array:Uint8Array}},buildTemporaryIndexesDataStore:{get:function(){return function(){this.M_A_=new this.idealConstructor(32)}}},getMin:{get:function(){return function(){for(this.I_[4]=0,this.I_[5]=this.length,this.I_[8]=this.getElement(this.uint_bitwise_5_(this.I_[4]));this.I_[4]<this.I_[5];this.I_[4]=this.plus_uint_(this.I_[4],32))if(!this.uint_equal_(this.I_[8],this.M_OPP_[0])&&(this.I_[3]=0,this.I_[7]=0,this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),this.I_[7]>0))return this.M_A_[0];return-1}}},getMax:{get:function(){return function(){for(this.I_[4]=this.length,this.I_[5]=0,this.I_[8]=this.getElement(this.uint_bitwise_5_(this.I_[4]));this.I_[4]>=this.I_[5];this.I_[4]=(this.I_[4]-32|0)>>>0)if(!this.uint_equal_(this.I_[8],this.M_OPP_[0])&&(this.I_[3]=0,this.I_[7]=0,this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),this.I_[7]>0))return this.M_A_[this.I_[7]-1|0];return-1}}},countOnes:{get:function(){return function(){for(this.I_[4]=0,this.I_[5]=this.length,this.I_[8]=this.getElement(this.uint_bitwise_5_(this.I_[4]));this.I_[4]<this.I_[5];this.I_[4]=this.plus_uint_(this.I_[4],32))this.uint_equal_(this.I_[8],this.M_OPP_[0])||(this.uint_equal_(this.I_[8],this.M_OPP_[1])?this.I_[6]=this.plus_uint_(this.I_[6],32):(this.I_[3]=0,this.I_[7]=0,this.readFourBytesCountByte(),this.readFourBytesCountByte(),this.readFourBytesCountByte(),this.readFourBytesCountByte(),this.I_[6]=this.plus_uint_(this.I_[6],this.I_[7])));return this.format_uint_(this.I_[6])}}},countZeros:{get:function(){return function(){return this.format_uint_(this.length-this.countOnes())}}},readFourBytes:{get:function(){return function(t,i,e){if(this.I_[4]=this.format_uint_(t),this.I_[9]=this.format_uint_(e),this.I_[3]=0,this.I_[7]=0,this.I_[8]=this.getElement(this.uint_bitwise_5_(this.I_[4])),this.uint_equal_(this.I_[8],this.M_OPP_[0]))return(0|this.I_[9])>>>0;if(this.uint_equal_(this.I_[8],this.M_OPP_[1])){if(void 0!==i)for(this.I_[10]=0;this.I_[10]<32;this.I_[10]=this.plus_uint_(this.I_[10],1))i[this.plus_uint_(this.I_[9],this.I_[10])]=this.plus_uint_(this.I_[4],this.I_[10]);return this.plus_uint_(this.I_[9],32)}return this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),this.readFourBytesCheckByte(),void 0!==i&&this.I_[7]>0&&i.set(this.M_A_.subarray(0,this.I_[7]),this.I_[9]),this.plus_uint_(this.I_[9],this.I_[7])}}},readFourBytesCountBit:{get:function(){return function(){this.uint_equal_(this.uint_bit_and_(this.I_[8],this.M_OR_[this.I_[3]]),this.M_OR_[this.I_[3]])&&(this.I_[7]=this.plus_uint_(this.I_[7],1)),this.I_[3]=this.plus_uint_(this.I_[3],1)}}},readFourBytesCheckBit:{get:function(){return function(){this.uint_equal_(this.uint_bit_and_(this.I_[8],this.M_OR_[this.I_[3]]),this.M_OR_[this.I_[3]])&&(this.M_A_[this.I_[7]]=this.plus_uint_(this.I_[4],this.I_[3]),this.I_[7]=this.plus_uint_(this.I_[7],1)),this.I_[3]=this.plus_uint_(this.I_[3],1)}}},readFourBytesCountByte:{get:function(){return function(){this.readFourBytesCountBit(),this.readFourBytesCountBit(),this.readFourBytesCountBit(),this.readFourBytesCountBit(),this.readFourBytesCountBit(),this.readFourBytesCountBit(),this.readFourBytesCountBit(),this.readFourBytesCountBit()}}},readFourBytesCheckByte:{get:function(){return function(){this.readFourBytesCheckBit(),this.readFourBytesCheckBit(),this.readFourBytesCheckBit(),this.readFourBytesCheckBit(),this.readFourBytesCheckBit(),this.readFourBytesCheckBit(),this.readFourBytesCheckBit(),this.readFourBytesCheckBit()}}},getElement:{get:function(){return function(t){return this.data_[t]}}},data:{get:function(){return this.data_}},dataCopy:{get:function(){return Uint32Array.from(this.data_)}},readBit:{get:function(){return function(t){return this.I_[0]=this.format_uint_(t),this.I_[1]=this.uint_bitwise_5_(this.I_[0]),this.I_[2]=this.uint_bit_and_(this.I_[0],31),this.uint_equal_(this.uint_bit_and_(this.data_[this.I_[1]],this.M_OR_[this.I_[2]]),this.M_OR_[this.I_[2]])}}},writeBit1:{get:function(){return function(t){this.I_[0]=this.format_uint_(t),this.I_[1]=this.uint_bitwise_5_(this.I_[0]),this.I_[2]=this.uint_bit_and_(this.I_[0],31),this.data_[this.I_[1]]=this.uint_bit_or_(this.data_[this.I_[1]],this.M_OR_[this.I_[2]])}}},writeBit0:{get:function(){return function(t){this.I_[0]=this.format_uint_(t),this.I_[1]=this.uint_bitwise_5_(this.I_[0]),this.I_[2]=this.uint_bit_and_(this.I_[0],31),this.data_[this.I_[1]]=this.uint_bit_and_(this.data_[this.I_[1]],this.M_AND_[this.I_[2]])}}},toggleBit:{get:function(){return function(t){return this.I_[0]=this.format_uint_(t),this.I_[1]=this.uint_bitwise_5_(this.I_[0]),this.I_[2]=this.uint_bit_and_(this.I_[0],31),this.uint_equal_(this.uint_bit_and_(this.data_[this.I_[1]],this.M_OR_[this.I_[2]]),this.M_OR_[this.I_[2]])?(this.data_[this.I_[1]]=this.uint_bit_and_(this.data_[this.I_[1]],this.M_AND_[this.I_[2]]),!1):(this.data_[this.I_[1]]=this.uint_bit_or_(this.data_[this.I_[1]],this.M_OR_[this.I_[2]]),!0)}}},setFromBitArrayData:{get:function(){return function(t){this.data_.length===t.length?this.data_.set(t):(this.data_=Uint32Array.from(t),this.buildTemporaryIndexesDataStore())}}},invert:{get:function(){return function(){for(var t=this.data_.length-1|0,i=0;(0|i)<(0|t);i=this.plus_uint_(i,1))this.data_[0|i]=~this.data_[0|i]}}},addFromArray:{get:function(){return function(t,i,e,n){var s,_;if(i=void 0===i?this.data_:i,void 0===e&&void 0===n)for(s=Math.min(t.length,i.length,this.data_.length)-1,_=0;(0|_)<(0|s);_=this.plus_uint_(_,1))this.data_[0|_]=this.uint_bit_or_(i[0|_],t[0|_]);else if(void 0!==e&&void 0===n)for(s=Math.min(t.length,i.length,e.length,this.data_.length)-1,_=0;(0|_)<(0|s);_=this.plus_uint_(_,1))this.data_[0|_]=this.uint_bit_or_(this.uint_bit_or_(i[0|_],t[0|_]),e[0|_]);else for(s=Math.min(t.length,i.length,e.length,this.data_.length)-1,_=0;(0|_)<(0|s);_=this.plus_uint_(_,1))this.data_[0|_]=this.uint_bit_or_(this.uint_bit_or_(t[0|_],i[0|_]),this.uint_bit_or_(e[0|_],n[0|_]))}}},differentFromArray:{get:function(){return function(t,i){i=void 0===i?this.data_:i;for(var e=Math.min(t.length,i.length,this.data_.length)-1,n=0;(0|n)<(0|e);n=this.plus_uint_(n,1))this.data_[0|n]=this.uint_bit_xor_(i[0|n],t[0|n])}}},sameFromArray:{get:function(){return function(t,i){i=void 0===i?this.data_:i;for(var e=Math.min(t.length,i.length,this.data_.length)-1,n=0;(0|n)<(0|e);n=this.plus_uint_(n,1))this.data_[0|n]=this.uint_bit_and_(i[0|n],t[0|n])}}},clear:{get:function(){return function(){this.data_.fill(0,0,this.data_.length-1)}}},charge:{get:function(){return function(){this.data_.fill(4294967295,0,this.data_.length-1)}}},length:{get:function(){return this.format_uint_(this.data_[this.data_.length-1])}},resize:{get:function(){return function(t){var i,e;this.length!==t&&(i=this.data_,(e=new Uint32Array(1+((t+31|0)>>>5)))[e.length-1]=(0|t)>>>0,e.set(i.subarray(0,Math.min(i.length-1,e.length-1))),this.data_=e,this.buildTemporaryIndexesDataStore())}}},resizeToMax:{get:function(){return function(){this.resize(this.getMax())}}}}),Object.defineProperties((h=function(e){var n,s;if(!(this instanceof h))return new h(e);if(this.format_uint_=r,this.plus_uint_=i,this.uint_equal_=t,this.VA_=Uint32Array.of(0),e instanceof h)this.ba_=e.bitArrayCopy,this.VA_.fill(e.size);else if(e instanceof o)this.ba_=e,this.VA_[0]=this.ba_.countOnes();else if("object"==typeof e){for(this.max_=0,this.c_=null,e instanceof Uint8ClampedArray||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array?(this.set_=new Set(e),this.VA_[0]=this.set_.size,this.c_=e instanceof Uint32Array?Uint32Array:e instanceof Uint16Array?Uint16Array:Uint8Array,this.indexes_=this.c_.from(this.set_)):(e instanceof Set?this.set_=e:this.set_=new Set(e),this.VA_[0]=this.set_.size,this.indexes_=Uint32Array.from(this.set_)),n=0,s=0|this.indexes_.length;this.format_uint_(n)<this.format_uint_(s);n=this.plus_uint_(n,1))this.format_uint_(this.max_)<this.format_uint_(this.indexes_[this.format_uint_(n)])&&(this.max_=this.format_uint_(this.indexes_[this.format_uint_(n)]));for(this.ba_=new o(this.max_),n=0,s=0|this.indexes_.length;this.format_uint_(n)<this.format_uint_(s);n=this.plus_uint_(n,1))this.ba_.writeBit1(this.format_uint_(this.indexes_[this.format_uint_(n)]));delete this.set_,delete this.indexes_,delete this.max_,delete this.c_}else this.ba_=new o(0|e),this.VA_[0]=0;return this.bindInnerMethods(),this}).prototype,{bindInnerMethods:{get:function(){return function(t){this.readbit_=this.ba_.readBit.bind(this.ba_),this.read4bytes_=this.ba_.readFourBytes.bind(this.ba_),this.write1_=this.ba_.writeBit1.bind(this.ba_),this.write0_=this.ba_.writeBit0.bind(this.ba_)}}},bitArrayCopy:{get:function(){return new o(this.bitArrayDataCopy)}},bitArrayData:{get:function(){return this.bitArray.data}},bitArrayDataCopy:{get:function(){var t=this.bitArrayData;return t.slice(0,t.length)}},bitArray:{get:function(){return this.ba_}},size:{get:function(){return this.format_uint_(this.VA_[0])}},length:{get:function(){return this.format_uint_(this.ba_.length)}},idealConstructor:{get:function(){return this.ba_.idealConstructor}},indexes:{get:function(){for(var t=new this.idealConstructor(this.size),i=Uint32Array.of(0|this.length,0,0);i[1]<i[0];i[1]=this.plus_uint_(i[1],32))i[2]=this.read4bytes_(i[1],t,i[2]);return t}},has:{get:function(){return function(t){return this.readbit_(this.format_uint_(t))}}},hasnt:{get:function(){return function(t){return!this.readbit_(this.format_uint_(t))}}},add:{get:function(){return function(t){t=this.format_uint_(t),(0|this.length)<(0|t)&&this.ba_.resize(t+t|0),this.hasnt(t)&&(this.VA_[0]=this.plus_uint_(this.VA_[0],1),this.write1_(t))}}},addUnsafe:{get:function(){return function(t){t=this.format_uint_(t),this.hasnt(t)&&(this.VA_[0]=this.plus_uint_(this.VA_[0],1),this.write1_(t))}}},"delete":{get:function(){return function(t){t=this.format_uint_(t),this.has(t)&&(this.write0_(t),this.VA_[0]=(this.VA_[0]-1|0)>>>0)}}},bulkAdd:{get:function(){return function(t){for(var i=Uint32Array.of(t.length,0);i[1]<i[0];i[1]=this.plus_uint_(i[1],1))this.add(t[i[1]])}}},bulkAddUnsafe:{get:function(){return function(t){for(var i=Uint32Array.of(t.length,0);i[1]<i[0];i[1]=this.plus_uint_(i[1],1))this.addUnsafe(t[i[1]])}}},bulkDelete:{get:function(){return function(t){for(var i=Uint32Array.of(t.length,0);i[1]<i[0];i[1]=this.plus_uint_(i[1],1))this["delete"](t[i[1]])}}},invert:{get:function(){return function(){var t=this.length,i=this.size;this.ba_.invert(),this.VA_[0]=t-i}}},clear:{get:function(){return function(){this.VA_[0]>0&&(this.ba_.clear(),this.VA_[0]=0)}}},clearAndBulkAdd:{get:function(){return function(t){this.clear(),this.bulkAdd(t)}}},clearAndBulkAddUnsafe:{get:function(){return function(t){this.clear(),this.bulkAddUnsafe(t)}}},setFromSetFixed:{get:function(){return function(t){this.ba_.setFromBitArrayData(t.bitArrayData),this.VA_[0]=t.size}}},computeSize:{get:function(){return function(){this.VA_[0]=this.ba_.countOnes()}}},optimize:{get:function(){return function(){this.ba_.resizeToMax()}}},resizeUnsafe:{get:function(){return function(t){this.ba_.resize(t)}}},resize:{get:function(){return function(t){this.resizeUnsafe(t),this.computeSize()}}},addFromSetFixedUnsafe:{get:function(){return function(t,i,e,n){this.ba_.addFromArray(t.bitArrayData,i instanceof h?i.bitArrayData:undefined,e instanceof h?e.bitArrayData:undefined,n instanceof h?n.bitArrayData:undefined)}}},differentFromSetFixedUnsafe:{get:function(){return function(t,i){this.ba_.differentFromArray(t.bitArrayData,i instanceof h?i.bitArrayData:undefined)}}},sameFromSetFixedUnsafe:{get:function(){return function(t,i){this.ba_.sameFromArray(t.bitArrayData,i instanceof h?i.bitArrayData:undefined)}}},addFromSetFixed:{get:function(){return function(t,i,e,n){this.addFromSetFixedUnsafe(t,i,e,n),this.computeSize()}}},differentFromSetFixed:{get:function(){return function(t,i){this.differentFromSetFixedUnsafe(t,i),this.computeSize()}}},sameFromSetFixed:{get:function(){return function(t,i){this.sameFromSetFixedUnsafe(t,i),this.computeSize()}}},charge:{get:function(){return function(){this.ba_.charge(),this.VA_[0]=this.ba_.length}}},forEach:{get:function(){return function(t){this.indexes.forEach(t)}}},map:{get:function(){return function(t){this.indexes.map(t)}}},filter:{get:function(){return function(t){this.indexes.filter(t)}}}}),{BitArray:o,SetFixed:h}}();"undefined"!=typeof t.exports&&(t.exports=e)},576:function(t,i,e){var n,s=e(487),_=e(479),r=(0,_.SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{uint32:!0,laba:!0,rgbaon4bits:!0,rgbaon6bits:!0,rgbaon8bits:!0,rgbaon12bits:!0,rgbaon16bits:!0,skin:!0},methods:{simplify:!0,get_new_element:!0,get_use_element:!0,set_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0,blend_all:!0,euclidean_match_with:!0,manhattan_match_with:!0,cie76_match_with:!0,copy:!0}}),o=Math.fround,h=o(.666),u=o(.666),a=(0,_.SIMDopeCreate)(r),l=a.simdops,c=a.Color,f=a.Colors,p=(l.minus_int,l.int_not_equal,l.plus_int,l.plus_uint,l.minus_uint,l.multiply_int,l.multiply_uint,l.multiply_uint_4),d=(l.divide_uint,l.clamp_uint8,l.clamp_uint32,l.int_equal,l.uint_less,l.int_less,l.int_greater_equal,l.uint_not_equal,l.uint_less_equal,l.min_uint,function g(t){if(t=t||{},!(this instanceof g))return new g(t);t.pxl_colors=t.pxl_colors||new Uint32Array(0),t.pxls=t.pxls||new Uint32Array(0),this.new_pxls_="buffer"in t.pxls?new Uint32Array(t.pxls.buffer):Uint32Array.from(t.pxls),this.new_pxl_colors_="buffer"in t.pxl_colors?new f(t.pxl_colors.buffer):new f(Uint32Array.from(t.pxl_colors).buffer);var i=0|this.new_pxl_colors_.length;this.new_pxl_colors_is_skin_mask_=new s.SetFixed(0|i),this.set_new_pxl_skin_mask(),this.best_color_number_=t.number_of_color,this.max_cluster_=i>65536?65537:i>16384?4097:i>8192?257:i>512?17:1,this.index_clusters_=Array(this.max_cluster_),this.length_clusters_=new Uint32Array(this.max_cluster_),this.pxl_colors_usage_=new Uint32Array(i),this.all_index_clusters_=new Uint32Array(i),this.clean_pxl_colors_=new Uint32Array(i),this.clean_pxl_colors_lookup_={},this.is_skin_ops_=0,this.match_ops_=0,this.blend_ops_=0,this.remove_duplicate_ops_=0,this.simplify_ops_=0,this.classify_on_x_bits_ops_=0});Object.defineProperty(d.prototype,"set_is_skin_ops",{get:function(){return function(t){this.is_skin_ops_=(0|t)>>>0}}}),Object.defineProperty(d.prototype,"set_match_ops",{get:function(){return function(t){this.match_ops_=(0|t)>>>0}}}),Object.defineProperty(d.prototype,"set_blend_ops",{get:function(){return function(t){this.blend_ops_=(0|t)>>>0}}}),Object.defineProperty(d.prototype,"set_remove_duplicate_ops",{get:function(){return function(t){this.remove_duplicate_ops_=(0|t)>>>0}}}),Object.defineProperty(d.prototype,"set_simplify_ops",{get:function(){return function(t){this.simplify_ops_=t}}}),Object.defineProperty(d.prototype,"set_classify_on_x_bits_ops",{get:function(){return function(t){this.classify_on_x_bits_ops_=t}}}),Object.defineProperty(d.prototype,"get_is_skin_ops",{get:function(){return function(){return 0|this.is_skin_ops_}}}),Object.defineProperty(d.prototype,"get_match_ops",{get:function(){return function(){return 0|this.match_ops_}}}),Object.defineProperty(d.prototype,"get_blend_ops",{get:function(){return function(){return 0|this.blend_ops_}}}),Object.defineProperty(d.prototype,"get_remove_duplicate_ops",{get:function(){return function(){return 0|this.remove_duplicate_ops_}}}),Object.defineProperty(d.prototype,"get_simplify_ops",{get:function(){return function(){return this.simplify_ops_}}}),Object.defineProperty(d.prototype,"get_classify_on_x_bits_ops",{get:function(){return function(){return this.classify_on_x_bits_ops_}}}),Object.defineProperty(d.prototype,"reset_deduplicate",{get:function(){return function(t){this.clean_pxl_colors_lookup_={},this.pxl_colors_usage_.fill(0,0,0|t),this.clean_pxl_colors_.fill(0,0,0|t)}}}),Object.defineProperty(d.prototype,"index_of_color_within_cleaned",{get:function(){return function(t){return(0|this.clean_pxl_colors_lookup_[(0|t)>>>0])-1|0}}}),Object.defineProperty(d.prototype,"set_cleaned_pxl_colors",{get:function(){return function(t,i){this.clean_pxl_colors_[(0|t)>>>0]=(0|i)>>>0,this.clean_pxl_colors_lookup_[(0|i)>>>0]=(t+1|0)>>>0}}}),Object.defineProperty(d.prototype,"increase_color_usage",{get:function(){return function(t){this.pxl_colors_usage_[(0|t)>>>0]=(this.pxl_colors_usage_[(0|t)>>>0]+1|0)>>>0}}}),Object.defineProperty(d.prototype,"set_new_pxls",{get:function(){return function(t,i){this.new_pxls_[(0|t)>>>0]=(0|i)>>>0}}}),Object.defineProperty(d.prototype,"set_new_pxl_colors",{get:function(){return function(t){this.new_pxl_colors_=new f(this.clean_pxl_colors_.buffer.slice(0,p(0|t))),this.set_new_pxl_skin_mask()}}}),Object.defineProperty(d.prototype,"set_new_pxl_skin_mask",{get:function(){return function(){var t=new c(new ArrayBuffer(4)),i=0|this.new_pxl_colors_.length,e=0;for(this.new_pxl_colors_is_skin_mask_=new s.SetFixed(0|i);(0|e)<(0|i);e=e+1|0)this.new_pxl_colors_.get_use_element(0|e,t).skin&&this.new_pxl_colors_is_skin_mask_.add(0|e);this.set_is_skin_ops(this.get_is_skin_ops()+e|0)}}}),Object.defineProperty(d.prototype,"get_a_new_pxl_color_from_pxl_index",{get:function(){return function(t){return 4294967295&this.new_pxl_colors_.buffer_getUint32(this.new_pxls_[0|t])}}}),Object.defineProperty(d.prototype,"reset_cluster",{get:function(){return function(){this.max_cluster_=this.new_pxl_colors_.length>65536?65537:this.new_pxl_colors_.length>16384?4097:this.new_pxl_colors_.length>8192?257:this.new_pxl_colors_.length>512?17:1,this.length_clusters_.fill(0,0,0|this.max_cluster);for(var t=0;(0|t)<(0|this.max_cluster);t=(t+1|0)>>>0)this.index_clusters_[0|t]=[]}}}),Object.defineProperty(d.prototype,"add_in_indexes_cluster",{get:function(){return function(t,i){this.index_clusters_[(0|t)>>>0].push((0|i)>>>0)}}}),Object.defineProperty(d.prototype,"set_all_cluster_indexes",{get:function(){return function(){for(var t=0,i=0;(0|t)<(0|this.max_cluster);t=(t+1|0)>>>0)this.all_index_clusters_.set(this.index_clusters_[(0|t)>>>0],(0|i)>>>0),i=(i+this.get_length_in_index_clusters(0|t)|0)>>>0}}}),Object.defineProperty(d.prototype,"get_length_in_index_clusters",{get:function(){return function(t){return(0|this.index_clusters_[(0|t)>>>0].length)>>>0}}}),Object.defineProperty(d.prototype,"get_in_cluster_lengths",{get:function(){return function(t){return(0|this.length_clusters_[(0|t)>>>0])>>>0}}}),Object.defineProperty(d.prototype,"get_an_index_in_clusters",{get:function(){return function(t){return(0|this.all_index_clusters_[0|t])>>>0}}}),Object.defineProperty(d.prototype,"get_a_color_usage",{get:function(){return function(t){return(0|this.pxl_colors_usage_[0|t])>>>0}}}),Object.defineProperty(d.prototype,"set_a_color_usage",{get:function(){return function(t,i){return this.pxl_colors_usage_[0|t]=(0|i)>>>0}}}),Object.defineProperty(d.prototype,"get_a_color_usage_percent",{get:function(){return function(t){return this.pxl_colors_usage_[0|t]/this.new_pxls_.length}}}),Object.defineProperty(d.prototype,"get_average_color_usage_percent",{get:function(){return function(t,i){var e,n,s;for(i=0|((i|=0)<(t|=0)?this.pxl_colors_usage_.length:i),e=0,n=0,s=0,n=0|t;(0|n)<(0|i);n=(n+1|0)>>>0)s=(0|this.get_an_index_in_clusters((0|n)>>>0))>>>0,e+=this.pxl_colors_usage_[0|s]/this.new_pxls_.length;return e/(i-t|0)}}}),Object.defineProperty(d.prototype,"get_a_new_pxl_color",{get:function(){return function(t){return this.new_pxl_colors_.get_new_element(0|t)}}}),Object.defineProperty(d.prototype,"is_pxl_color_skin",{get:function(){return function(t){return this.new_pxl_colors_is_skin_mask_.has(0|t)}}}),Object.defineProperty(d.prototype,"max_cluster",{get:function(){return 0|this.max_cluster_}}),Object.defineProperty(d.prototype,"new_pxls_length",{get:function(){return 0|this.new_pxls_.length}}),Object.defineProperty(d.prototype,"new_pxl_colors_length",{get:function(){return 0|this.new_pxl_colors_.length}}),Object.defineProperty(d.prototype,"best_color_number",{get:function(){return 0|this.best_color_number_}}),Object.defineProperty(d.prototype,"get_data",{get:function(){return function(){return Array.of(this.new_pxls_,this.new_pxl_colors_.subarray_uint32(0,this.new_pxl_colors_.length),{deduplicate:this.get_remove_duplicate_ops(),simplify:this.get_simplify_ops(),classify:this.get_classify_on_x_bits_ops(),skin:this.get_is_skin_ops(),blend:this.get_blend_ops(),match:this.get_match_ops()})}}}),d.prototype.output=function(t){var i,e;return t=t||"heap",i=this.get_data(),"heap"==t?((e=new Uint32Array(2+i[0].length+i[1].length))[0]=0|i[0].length,e[1]=0|i[1].length,e.set(i[0],2),e.set(i[1],2+i[0].length),e.buffer):i},d.prototype.deduplicate=function(){var t,i,e,n,s;for(this.set_remove_duplicate_ops(this.get_remove_duplicate_ops()+1|0),this.reset_deduplicate(0|this.new_pxl_colors_length),t=0,i=0,e=0,n=0,s=0|this.new_pxls_length;(0|n)<(0|s);n=(n+1|0)>>>0)i=0|this.get_a_new_pxl_color_from_pxl_index(0|n),-1==(0|(e=0|this.index_of_color_within_cleaned(0|i)))&&(this.set_cleaned_pxl_colors(0|t,0|i),e=0|t,t=t+1|0),this.increase_color_usage(0|e),this.set_new_pxls(0|n,0|e);this.set_new_pxl_colors(t)},d.prototype.clusterize=function(){this.reset_cluster();var t=0;if(65537===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon16bits)>>>0,(0|t)>>>0);else if(4097===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon12bits)>>>0,(0|t)>>>0);else if(257===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon8bits)>>>0,(0|t)>>>0);else if(17===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon4bits)>>>0,(0|t)>>>0);else if(1===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster(0,(0|t)>>>0);this.max_cluster>1&&this.set_classify_on_x_bits_ops(this.get_classify_on_x_bits_ops()+this.new_pxl_colors_length),this.set_all_cluster_indexes()},d.prototype.process_threshold=function(t){var i,e,n,s,_,r,a,l,f,p,d,g,y,x,b,m,w,I,A,B,F;for(i=!1,e=[],n=[],s=0,_=0,l=!1,f=!1,p=0,d=0,g=o((t=(0|t)>>>0)/255),b=0,m=0,w=0,I=0,A=0,B=0,F=0,x=o(g*u),y=o(g*h);(0|A)<(0|this.max_cluster);A=(A+1|0)>>>0){for(_=(s+((0|this.get_length_in_index_clusters(0|A))>>>0)|0)>>>0,w=0|s;(0|w)<(0|_);w=(w+1|0)>>>0){if(b=(0|this.get_an_index_in_clusters((0|w)>>>0))>>>0,r=this.get_a_new_pxl_color((0|b)>>>0),l=this.is_pxl_color_skin((0|b)>>>0),(0|(p=(0|this.get_a_color_usage((0|b)>>>0))>>>0))>0)for(e=[],I=0|s;(0|I)<(0|_);I=(I+1|0)>>>0)m=(0|this.get_an_index_in_clusters((0|I)>>>0))>>>0,a=this.get_a_new_pxl_color((0|m)>>>0),f=this.is_pxl_color_skin((0|m)>>>0),(0|(d=(0|this.get_a_color_usage((0|m)>>>0))>>>0))>0&&(0|b)!=(0|m)&&(F=(F+1|0)>>>0,r.euclidean_match_with(a,l&&f?x:l||f?y:g)&&(i=!0,this.set_a_color_usage(0|m,0),e.push(a),n.push(o(d/p))));(0|e.length)>0&&(c.blend_all(r,e,n),B=(B+e.length+1|0)>>>0,e=[],n=[])}s=0|_}return this.set_match_ops(this.get_match_ops()+F),this.set_blend_ops(this.get_blend_ops()+B),i},d.prototype.round=function(){var t,i;if(this.new_pxl_colors_length>8192){for(t=0|(this.new_pxl_colors_length>32768?12:this.new_pxl_colors_length>16384?10:this.new_pxl_colors_length>8192?8:this.new_pxl_colors_length>2048?6:this.new_pxl_colors_length>512?4:2),i=0;(0|i)<(0|this.new_pxl_colors_length);i=(i+1|0)>>>0)this.get_a_new_pxl_color((0|i)>>>0).simplify(t);this.set_simplify_ops(this.get_simplify_ops()+this.new_pxl_colors_length)}},d.prototype.init=function(){return this.round(),this.deduplicate(),this.clusterize(),this},d.prototype.run=function(){for(var t=2*(this.new_pxl_colors_length>32768?6:this.new_pxl_colors_length>16384?5:this.new_pxl_colors_length>8192?4:this.new_pxl_colors_length>4096?3:this.new_pxl_colors_length>2048?2:1)|0;(0|t)<=255&&(this.process_threshold(0|t)?(this.deduplicate(),this.clusterize()):t=t+(this.new_pxl_colors_length>32768?6:this.new_pxl_colors_length>16384?5:this.new_pxl_colors_length>8192?4:this.new_pxl_colors_length>4096?3:this.new_pxl_colors_length>2048?2:1)|0,t=t+(this.new_pxl_colors_length>32768?6:this.new_pxl_colors_length>16384?5:this.new_pxl_colors_length>8192?4:this.new_pxl_colors_length>4096?3:this.new_pxl_colors_length>2048?2:1)|0,!(this.new_pxl_colors_length<=this.best_color_number)););return this},n=function(t,i){return new Promise((function(e){var n,s,_,r,o,h,u,a,l=new Uint32Array(t.data.buffer),c=Uint32Array.from(new Set(l)),f={},p=c.length,g=new Uint32Array(l.length);for(n=0,s=0|p;(0|n)<(0|s);n=(n+1|0)>>>0)f[c[0|n]]=(0|n)>>>0;for(n=0,s=0|l.length;(0|n)<(0|s);n=(n+1|0)>>>0)g[0|n]=(0|f[l[0|n]])>>>0;for(_=Date.now(),r=d({pxls:g,pxl_colors:c,number_of_color:i,width:t.width,height:t.height}).init().run().output("split"),o=Date.now(),u=0|(h=r[0]).length,h.length,a=r[1],n=0;(0|n)<(0|u);n=(n+1|0)>>>0)l[0|n]=(0|a[(0|h[0|n])>>>0])>>>0;e([t=new ImageData(new Uint8ClampedArray(l.buffer),t.width,t.height),p-a.length,a.length,o-_|0])}))},t.exports={QuantiMatGlobal:n,QuantiMat:d}}}]);